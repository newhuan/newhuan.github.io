# 一次mysql问题的修复

2021-07-10

表现：数据关联报错：Data truncated for column ordinal at row 1

调试经过：

首先google查询这个报错,发现是在数据类型发生转换的时候会出现这样的问题，不过一般是发生在insert和update的时候，数据关联是完全的select请求

之后继续定位细节，发现自定义函数declear的时候也会出现类似的问题，问题焦点转移到自定义函数中。

之后使用卡特测试环境（mysql 5.7）创建了一个复现环境，进入系统将报错的sql完整复现出来，发现复现环境的sql查询一切正常，同样的sql在客户的数据库里就会报[表现]中的错误。

之后精简sql,发现问题的核心在set_equal_plus方法，尝试删除重新导入set_equal_plus之后问题修复。

对比前后的方法show create function的内容发现，'\t'和'\0'特殊字符被分别转换成四空格和乱码，这个就是问题的直接原因。



问题溯源：

特殊字符被转换，尤其是\t的转换，直觉猜测是编辑器做的转换，和客户确认后，确定客户使用phpMyAdmin编辑器编辑过sql文件，导致特殊字符被编辑器修改。



经验教训：

1. sql文件尽量用纯文本编辑器修改，vim/gvim/sublime等
2. mysql只要支持中文，显示的乱码**不要**认为是正常的，**验证**下。
3. 修复bug的第一步是复现bug，不要瞎猜，去验证。
4. 不要害怕，不要自我设限。

